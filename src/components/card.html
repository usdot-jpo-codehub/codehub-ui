<template>
  <require from="resources/value-converters/num"></require>
  <require from="resources/value-converters/ago"></require>
  <require from="resources/custom-attributes/bootstrap-tooltip"></require>

  <div if.bind="repo" class="" style="">
    <div class="card card-default hover-card">
      <div if.bind="repo.codehubData.badges.isFeatured && showFeatured" class="ribbon-wrapper">
        <div id="card-popular-featured-ribbon-${repo.id}" tabindex="0" class="ribbon" role="img" aria-label="Featured ribbon image.">Featured</div>
      </div>
      <div class="card-header">
        <div tabindex="0" class="lang-logo" role="img" aria-label="Language icon ${repo.sourceData.language}">
          <span>
            <img alt="Language icon ${repo.sourceData.language}" if.bind="repo.sourceData.owner.type != 'foundation'" src.bind="language_image" onError="this.onerror=null;this.src='/img/language-icons/default.svg';">
            <img if.bind="repo.sourceData.owner.type == 'foundation'" src="/img/language-icons/foundation.svg" onError="this.onerror=null;this.src='/img/language-icons/default.svg';" alt="Foundation">
          </span>
        </div>
        <div class="card-title multiline">
          <a id="card-popular-title-link-${repo.id}" href="#" route-href="route:project-details; params.bind: {id:repo.id}" aria-label="Project name: ${repo.sourceData.name}">${repo.sourceData.name}</a>
        </div>
        <div tabindex="0" class="org-name">${language}</div>
      </div>
      <div tabindex="0" class="proj-desc ${hasdescription ? '' : 'no-desc'} multiline">${description}</div>
      <div class="text-muted last-updated">
        <em class="text-muted">Source:
          <a if.bind="infected_files == 0" id="card-popular-project-status-link-${repo.id}" href="#" click.trigger="dialogFunctions.openLeavingSiteConfirmation(repo.sourceData.name,repo.sourceData.repositoryUrl,$event.target)"  target="_blank" aria-label="View source code on Github.">Github™</a>
          <a if.bind="infected_files > 0" id="card-popular-project-status-link-${repo.id}" href="#" click.trigger="dialogFunctions.displayVScanDialog(repo,$event.target)"  target="_blank" aria-label="View source code on Github.">Github™</a>
        </em>
        &nbsp; | &nbsp;
        <span tabindex="0" id="card-popular-organization-updated-text-${repo.id}">Updated ${repo.sourceData.lastPush | ago}</span>
        <span class="pull-right repo-status">
          <a id="card-popular-metrics-${repo.id}" href="#" click.trigger="showHideMetrics()" bootstrap-tooltip data-toggle="tooltip" data-placement="top" aria-label="Show or Hide Metrics">${metricsText}</a>
        </span>
      </div>

      <div if.bind="showMetrics" class="card-stats lined-header project-stats-header card-footer">
        <span class="pull-right">
          <span aria-hidden="true">By&nbsp;</span>
          <a id="card-popular-organization-link-${repo.id}" href="#" click.trigger="dialogFunctions.openLeavingSiteConfirmation(repo.sourceData.owner.name,repo.sourceData.owner.url,$event.target)" bootstrap-tooltip data-toggle="tooltip" data-placement="top" aria-label="Project organization: ${repo.sourceData.owner.name}, view on GitHub." target="_blank">${repo.sourceData.owner.name}</a>
        </span>
        <span tabindex="0" class="text-muted"  aria-label="Project Stats">Project Stats</span>
      </div>

      <div if.bind="showMetrics" class="grid-row github-stats">
        <div class="grid-col-3 grid-custom_left">
          <span class="stat" tabindex="0" aria-label="${repo.sourceData.stars} stars">
            <span class="octicon octicon-star" aria-hidden="true"></span>
            <span id="card-popular-project-stars-${repo.id}" class="num text-muted text-emphasized" aria-hidden="true">${repo.sourceData.stars | num}</span>
            <span class="stat-label" aria-hidden="true">stars</span>
          </span>
        </div>
        <div class="grid-col-3 grid-custom_middle-left">
          <span class="stat" tabindex="0" aria-label="${repo.sourceData.watchers | num} watchers">
            <span class="octicon octicon-eye" aria-hidden="true"></span>
            <span id="card-popular-project-watchers-${repo.id}" class="num text-muted text-emphasized" aria-hidden="true">${repo.sourceData.watchers | num}</span>
            <span class="stat-label" aria-hidden="true">watchers</span>
          </span>
        </div>
        <div class="grid-col-3 grid-custom_middle-right">
          <span class="stat" tabindex="0" aria-label="${repo.sourceData.contributors.length} contributors">
            <span class="octicon octicon-organization" aria-hidden="true"></span>
            <span id="card-popular-project-contributors-${repo.id}" class="num text-muted text-emphasized" aria-hidden="true">${repo.sourceData.contributors.length | num}</span>
            <span class="stat-label" aria-hidden="true">contributors</span>
          </span>
        </div>
        <div class="grid-col-3 grid-custom_right">
          <span class="stat" tabindex="0" aria-label="${releases.length | num} releases">
            <span class="octicon octicon-tag" aria-hidden="true"></span>
            <span id="card-popular-project-releases-${repo.id}" class="num text-muted text-emphasized" aria-hidden="true">${releases.length | num}</span>
            <span class="stat-label" aria-hidden="true">releases</span>
          </span>
        </div>
      </div>

      <div if.bind="showMetrics" class="grid-row github-stats">
        <div class="grid-col-3 grid-custom_left">
          <span class="stat" tabindex="0" aria-label="${repo.sourceData.forks.length | num} forks">
            <span class="octicon octicon-repo-forked" aria-hidden="true"></span>
            <span id="card-popular-project-forks-${repo.id}" class="num text-muted text-emphasized" aria-hidden="true">${repo.sourceData.forks.length | num}</span>
            <span class="stat-label" aria-hidden="true">forks</span>
          </span>
        </div>
        <div class="grid-col-3 grid-custom_middle-left">
          <span class="stat" tabindex="0" aria-label="${repo.sourceData.commits} commits">
            <span class="octicon octicon-git-commit" aria-hidden="true"></span>
            <span id="card-popular-project-commits-${repo.id}" class="num text-muted text-emphasized" aria-hidden="true">${repo.sourceData.commits | num:1}</span>
            <span class="stat-label" aria-hidden="true">commits</span>
          </span>
        </div>
        <div class="grid-col-3 grid-custom_middle-right">
          <span class="stat" tabindex="0" aria-label="${downloads} downloads">
            <span class="octicon octicon-cloud-download" aria-hidden="true"></span>
            <span id="card-popular-project-downloads-${repo.id}" class="num text-muted text-emphasized" aria-hidden="true">${downloads | num}</span>
            <span class="stat-label" aria-hidden="true">downloads</span>
          </span>
        </div>
        <div class="grid-col-3 grid-custom_right">
          <span class="${infected_files>0?'stat-vscan':'stat'}" tabindex="0" aria-label="${infected_files} infected files">
            <span class="octicon ${infected_files>0?'octicon-bug':'octicon-check'}" aria-hidden="true"></span>
            <span id="card-popular-project-infected-files-${repo.id}" class="num ${(infected_files>0)?'':' text-muted text-emphasized'}" aria-hidden="true">${infected_files | num}</span>
            <span class="stat-label" aria-hidden="true">viruses</span>
          </span>
        </div>
      </div>

      <div class="grid-row card-links">
        <ul class="list-inline pull-left">
          <li><a id="card-popular-project-open-readme-${repo.id}" href="#" click.trigger="dialogFunctions.openReadmeModal(repo,$event.target)" aria-label="Show readme file"><em class="material-icons">library_books</em> Show README</a></li>
        </ul>
        <ul class="list-inline pull-right">
          <li if.bind="badge_status_image"><a href="#" route-href="route:badges-about" title="Status ${repo.codehubData.badges.status}"><img alt="Badge status image" class="badge-status-img" src.bind="badge_status_image"></a></li>
        </ul>
      </div>

      <a class="card-link" href="#" route-href="route:project-details; params.bind: {id:repo.id}" aria-label="Open details for project ${repo.sourceData.name}">&nbsp;</a>
    </div>
  </div>
</template>
